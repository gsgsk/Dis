import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;

public class MarkupLan {

	static ArrayList<NetworkMachine> machines = new ArrayList<NetworkMachine> ();
	
	public static void main(String[] args) {
		// TODO Auto-generated method stub
		//System.out.println("Hello World!!!");
		
		
		//Creating a JSON parser
		JSONParser parser = new JSONParser();
		
		Object obj;
		try {
			//Copying the file into a JSON object
			obj = parser.parse (new FileReader("/home/csc/Desktop/Dissertation/abc/dump.json"));
			
			//Creating a JSON array
			JSONArray json = (JSONArray) obj;
			//System.out.println(json);
			
			JSONObject jsonObj = new JSONObject();
			JSONObject source = new JSONObject();
			JSONObject layers = new JSONObject();
			JSONObject arp = new JSONObject();
			JSONObject ip = new JSONObject();
			
			NetworkMachine src, dst;
			NetworkMachine temp;
			
			boolean containsSrc = false, containsDst = false;
			
			//Looping through the JSON array to look for arp packets
			for (int i = 0; i < json.size(); i++)
			{
				//System.out.println(i);
				//System.out.println(json[i].);
				jsonObj = (JSONObject) json.get(i);
				//System.out.println(jsonObj.get("_source"));
				source = (JSONObject) jsonObj.get("_source");
				//System.out.println(source);
				layers = (JSONObject) source.get("layers");
				//System.out.println(layers);
				
				//Checking if the packet contains arp data
				if (layers.containsKey("arp"))
				{
					//System.out.println(layers.get("arp"));
					arp = (JSONObject) layers.get("arp");
					
					//Ensuring that both the machines exist in the network & the arp wasn't a failed request
					if (arp.get("arp.opcode").equals("2"))
					{
						/*System.out.println(i);
						System.out.println("Source ip: " + arp.get("arp.src.proto_ipv4"));
						System.out.println("Source mac: " + arp.get("arp.src.hw_mac"));
						System.out.println("Destination ip: " + arp.get("arp.dst.proto_ipv4"));
						System.out.println("Destination mac: " + arp.get("arp.dst.hw_mac"));
						System.out.println("");*/
						
						//Copying the source and the distination addresses
						src = new NetworkMachine (arp.get("arp.src.proto_ipv4"),arp.get("arp.src.hw_mac"));
						dst = new NetworkMachine (arp.get("arp.dst.proto_ipv4"),arp.get("arp.dst.hw_mac"));
						
						if (machines.size() == 0)
						{
							//Adding the machines to the arraylist
							machines.add(src);
							machines.add(dst);
						}
						
						//Ensuring no duplicates exists
						else
						{
							
							System.out.println(i);
							System.out.println("Source");
							for (int j = 0 ;j<machines.size();j++)
							{
								temp = machines.get(j);
								if (temp.equals(src))
								{
									containsSrc = true;
								}
							}
							System.out.println(containsSrc);
							containsSrc = false;
							src.print();
							System.out.println();
							System.out.println();
							
							System.out.println("Distination");
							
							for (int j = 0 ;j<machines.size();j++)
							{
								temp = machines.get(j);
								if (temp.equals(dst))
								{
									containsDst = true;
								}
							}
							System.out.println(containsDst);
							containsDst = false;
							dst.print();
							System.out.println();
							System.out.println();
							
							/*if (machines.contains(src))
							{
								containsSrc = true;
							}
							
							if (machines.contains(dst))
							{
								containsSrc = true;
							}
							
							if (!containsSrc)
							{
								machines.add(src);
								containsSrc = false;
							}
							
							if (!containsDst)
							{
								machines.add(dst);
								containsDst = false;
							}*/
						}
					}
				}
				
				/*else if (layers.containsKey("ip"))
				{
					ip = (JSONObject) layers.get("ip");
					//System.out.println(ip);
					System.out.println(i);
					System.out.println("Source IP: " + ip.get("ip.src") + "------> Destination IP: " + ip.get("ip.dst"));
					System.out.println("");
				}*/
			}
			
			
			for (int i=0; i<machines.size(); i++)
			{
				//System.out.println("This part works!!!");
				temp = machines.get(i);
				temp.print();
				
			}
			
		} catch (FileNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (ParseException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}

}

class NetworkMachine
{
	private String ip;
	private String mac_add;
	private boolean gwDevice = false;
	
	
	
	/**
	 * 
	 */
	public NetworkMachine() {
		super();
	}

	public NetworkMachine(String ip, String mac_add, boolean gwDevice) {
		super();
		this.ip = ip;
		this.mac_add = mac_add;
		this.gwDevice = gwDevice;
	}
	
	/**
	 * @param object
	 * @param object2
	 */
	public NetworkMachine(Object object, Object object2) {
		super();
		this.ip = (String) object;
		this.mac_add = (String) object2;
	}
	
	

	/**
	 * @return the ip
	 */
	public String getIp() {
		return ip;
	}
	/**
	 * @param ip the ip to set
	 */
	public void setIp(String ip) {
		this.ip = ip;
	}
	/**
	 * @return the mac_add
	 */
	public String getMac_add() {
		return mac_add;
	}
	/**
	 * @param mac_add the mac_add to set
	 */
	public void setMac_add(String mac_add) {
		this.mac_add = mac_add;
	}
	/**
	 * @return the gwDevice
	 */
	public boolean isgwDevice() {
		return gwDevice;
	}
	/**
	 * @param gwDevice the gwDevice to set
	 */
	public void setgwDevice(boolean gwDevice) {
		this.gwDevice = gwDevice;
	}
	
	public void print() {
		System.out.println("IP address = " + ip + " MAC address = " + mac_add + " Gateway Device = " + gwDevice);
	}
	
}

/*Tutorials and websites used for coding and understanding the concepts
 * Arraylist:-
 * https://docs.oracle.com/javase/8/docs/api/java/util/ArrayList.html
 * https://beginnersbook.com/2013/12/java-arraylist/
 *  
 * JSONObject:-
 * https://www.mkyong.com/java/json-simple-example-read-and-write-json/
 * 
 */
